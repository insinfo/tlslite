import 'dart:typed_data';
import 'package:tlslite/src/utils/brotlidecpy/decode.dart' as brotli;

void main() {
  // Ukkonooa test data
  final compressed = Uint8List.fromList([
    0x1b, 0x76, 0x00, 0x00, 0x14, 0x4a, 0xac, 0x9b, 0x7a, 0xbd, 0xe1, 0x97,
    0x9d, 0x7f, 0x8e, 0xc2, 0x82, 0x36, 0x3e, 0x64, 0xf2, 0x92, 0xd2, 0xd2,
    0x12, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03,
  ]);
  final expected = 'ukko nooa, ukko nooa oli mies, kun han meni saunaan, pansen lanseansen lanansen sansen, henansen tansen sopansen, pansen lanansen sansen henansen tansen soppiansen';
  
  print('Input length: ${compressed.length}');
  print('Expected output: "$expected"');
  print('Expected length: ${expected.length}');
  
  final result = brotli.brotliDecompressBuffer(compressed);
  final resultStr = String.fromCharCodes(result);
  
  print('\nActual output: "$resultStr"');
  print('Actual length: ${result.length}');
  
  // Find first difference
  for (int i = 0; i < expected.length && i < result.length; i++) {
    if (expected.codeUnitAt(i) != result[i]) {
      print('\nFirst difference at position $i:');
      print('  Expected: ${expected.codeUnitAt(i)} (${expected[i]})');
      print('  Actual:   ${result[i]} (${String.fromCharCode(result[i])})');
      print('\nContext around position $i:');
      int start = i > 5 ? i - 5 : 0;
      int end = i + 10 < expected.length ? i + 10 : expected.length;
      print('  Expected: "${expected.substring(start, end)}"');
      if (end <= result.length) {
        print('  Actual:   "${String.fromCharCodes(result.sublist(start, end))}"');
      }
      break;
    }
  }
  
  if (result.length != expected.length) {
    print('\nLength mismatch: expected ${expected.length}, got ${result.length}');
  }
}
